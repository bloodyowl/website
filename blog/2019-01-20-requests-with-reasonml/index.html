<!DOCTYPE html><html lang="en"><head><title data-react-helmet="true">Requests with ReasonML - Matthias Le Brun (@bloodyowl)</title><meta data-react-helmet="true" name="description" value="Front-end developer and designer. ReasonML, ReasonReact, ReactJS."/><meta data-react-helmet="true" charset="UTF-8"/><meta data-react-helmet="true" content="w75-P-0ywXWkyZvYPbkSM3VSM2hny25UrfeiWJt3B1k" name="google-site-verification"/><meta data-react-helmet="true" content="width=device-width, initial-scale=1, shrink-to-fit=no, viewport-fit=cover" name="viewport"/><meta data-react-helmet="true" content="summary_large_image" name="twitter:card"/><meta data-react-helmet="true" content="website" property="og:type"/><meta data-react-helmet="true" content="https://bloodyowl.io/public/assets/images/share.jpg" property="og:image"/><meta data-react-helmet="true" content="https://bloodyowl.io/public/assets/images/share.jpg" name="twitter:image"/><meta data-react-helmet="true" content="@bloodyowl" name="twitter:site"/><meta data-react-helmet="true" content="1500" property="og:image:width"/><meta data-react-helmet="true" content="777" property="og:image:height"/><link data-react-helmet="true" href="/public/assets/images/favicon.png" rel="shortcut icon"/><link data-react-helmet="true" href="https://bloodyowl.io/blog/2019-01-20-requests-with-reasonml/" rel="canonical"/><style data-react-helmet="true" >@import url("//hello.myfonts.net/count/3cae5f")</style><script>window.PAGES_BOOT_MODE="hydrate";</script></head><div id="root"><style data-emotion="rpcss ab7sxj 13ah45v 1rqpwbm 28v1b4 zx73cm">@-webkit-keyframes animation-ab7sxj{from{-webkit-transform:scaleX(0);-moz-transform:scaleX(0);-ms-transform:scaleX(0);transform:scaleX(0);}}@keyframes animation-ab7sxj{from{-webkit-transform:scaleX(0);-moz-transform:scaleX(0);-ms-transform:scaleX(0);transform:scaleX(0);}}@-webkit-keyframes animation-13ah45v{50%{opacity:0.5;}}@keyframes animation-13ah45v{50%{opacity:0.5;}}@font-face{font-family:HelveticaNowDisplay;src:url("/public/assets/webfonts/regular.woff2"),url("/public/assets/webfonts/regular.woff");font-style:normal;font-weight:400;font-display:swap;}@font-face{font-family:HelveticaNowDisplay;src:url("/public/assets/webfonts/bold.woff2"),url("/public/assets/webfonts/bold.woff");font-style:normal;font-weight:700;font-display:swap;}@media (prefers-reduced-motion: reduce){*,*::before,*::after{-webkit-animation-duration:0.01ms!important;animation-duration:0.01ms!important;-webkit-animation-iteration-count:1!important;animation-iteration-count:1!important;transition-duration:0.01ms!important;scroll-behavior:auto!important;}}body{font-family:HelveticaNowDisplay,"Helvetica Neue",Helvetica,Arial,sans-serif;margin:0;padding:0;}*,*::before,*::after{box-sizing:border-box;}a:active,button:active{opacity:0.5;}pre,.hljs{color:#adbac7;background:#22272e;}.hljs-doctag,.hljs-keyword,.hljs-meta .hljs-keyword,.hljs-template-tag,.hljs-template-variable,.hljs-type,.hljs-variable.language_{color:#f47067;}.hljs-title,.hljs-title.class_,.hljs-title.class_.inherited__,.hljs-title.function_{color:#dcbdfb;}.hljs-attr,.hljs-attribute,.hljs-literal,.hljs-meta,.hljs-number,.hljs-operator,.hljs-variable,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id{color:#6cb6ff;}.hljs-regexp,.hljs-string,.hljs-meta .hljs-string{color:#96d0ff;}.hljs-built_in,.hljs-symbol{color:#f69d50;}.hljs-comment,.hljs-code,.hljs-formula{color:#768390;}.hljs-name,.hljs-quote,.hljs-selector-tag,.hljs-selector-pseudo{color:#8ddb8c;}.hljs-subst{color:#adbac7;}.hljs-section{color:#316dca;font-weight:bold;}.hljs-bullet{color:#eac55f;}.hljs-emphasis{color:#adbac7;font-style:italic;}.hljs-strong{color:#adbac7;font-weight:bold;}.hljs-addition{color:#b4f1b4;background-color:#1b4721;}.hljs-deletion{color:#ffd8d3;background-color:#78191b;}@-webkit-keyframes animation-zx73cm{from{opacity:0;-webkit-transform:translateY(20px);-moz-transform:translateY(20px);-ms-transform:translateY(20px);transform:translateY(20px);}}@keyframes animation-zx73cm{from{opacity:0;-webkit-transform:translateY(20px);-moz-transform:translateY(20px);-ms-transform:translateY(20px);transform:translateY(20px);}}</style><div><style data-emotion="rpcss 16zgwmd">.rpcss-16zgwmd{width:100%;margin:0 auto;padding:10px;max-width:1024px;position:relative;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;}</style><div class="rpcss-16zgwmd"><style data-emotion="rpcss 8rypvw">.rpcss-8rypvw{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;min-height:20vh;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;padding:20px 0;}@media (max-width: 600px){.rpcss-8rypvw{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;}}</style><header class="rpcss-8rypvw"><style data-emotion="rpcss pn3oo7">.rpcss-pn3oo7{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;-webkit-text-decoration:none;text-decoration:none;color:inherit;}@media (max-width: 600px){.rpcss-pn3oo7{-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;text-align:center;margin-bottom:10px;}}</style><a class="rpcss-pn3oo7" href="/"><style data-emotion="rpcss 15splxt">.rpcss-15splxt{width:10%;min-width:80px;}</style><div class="rpcss-15splxt"><style data-emotion="rpcss 1en06ca">.rpcss-1en06ca{padding-bottom:100%;position:relative;}</style><div class="rpcss-1en06ca"><style data-emotion="rpcss 1asitu4">.rpcss-1asitu4{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:contain;object-position:50% 50%;}</style><img class="rpcss-1asitu4" alt="" src="/public/assets/images/logo.svg"/></div></div><style data-emotion="rpcss klacsp">.rpcss-klacsp{width:0;height:10px;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;}</style><div class="rpcss-klacsp"></div><style data-emotion="rpcss 8yb3q0">.rpcss-8yb3q0{margin:0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;font-weight:normal;font-size:1.25rem;line-height:1.2;}</style><h1 class="rpcss-8yb3q0"><span>Matthias Le Brun</span><strong>@bloodyowl</strong></h1></a><style data-emotion="rpcss j8u6wc">.rpcss-j8u6wc{width:0;height:20px;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;}</style><div class="rpcss-j8u6wc"></div><nav><style data-emotion="rpcss ub2jfj">.rpcss-ub2jfj{font-size:1.25rem;font-weight:700;padding:10px 20px;-webkit-text-decoration:none;text-decoration:none;color:inherit;position:relative;}.rpcss-ub2jfj::before{content:"→ ";}@media (max-width: 600px){.rpcss-ub2jfj::before{content:none;}}</style><a class="rpcss-ub2jfj" href="/design">design</a><a class="rpcss-ub2jfj" href="/talks">talks</a><style data-emotion="rpcss 1cjk52a">.rpcss-1cjk52a{font-size:1.25rem;font-weight:700;padding:10px 20px;-webkit-text-decoration:none;text-decoration:none;color:inherit;position:relative;}.rpcss-1cjk52a::before{content:"→ ";}@media (max-width: 600px){.rpcss-1cjk52a::before{content:none;}}.rpcss-1cjk52a::after{content:"";position:absolute;bottom:0;left:20px;right:15px;height:3px;background-color:#000;transform-origin:0 0;-webkit-animation:200ms ease-in-out animation-ab7sxj;animation:200ms ease-in-out animation-ab7sxj;}@media (max-width: 600px){.rpcss-1cjk52a::after{right:20px;}}</style><a class="rpcss-1cjk52a" href="/blog">blog</a></nav></header></div><style data-emotion="rpcss 60zypc">.rpcss-60zypc{-webkit-animation:300ms ease-in-out animation-zx73cm;animation:300ms ease-in-out animation-zx73cm;}</style><div class="rpcss-60zypc"><div class="rpcss-16zgwmd"><style data-emotion="rpcss n0fndg">.rpcss-n0fndg{max-width:640px;margin:20px auto;padding:0 10px;width:100%;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}</style><div class="rpcss-n0fndg"><style data-emotion="rpcss apovzu">.rpcss-apovzu{margin:0;font-size:48px;margin-top:50px;margin-bottom:10px;line-height:1.15;}</style><h1 class="rpcss-apovzu">Requests with ReasonML</h1><style data-emotion="rpcss 12xm3b2">.rpcss-12xm3b2{font-size:14px;opacity:0.5;margin-bottom:50px;}</style><div class="rpcss-12xm3b2">2019/01/20</div><style data-emotion="rpcss tmgyw8">.rpcss-tmgyw8{margin-top:40px;font-size:20px;line-height:1.5;}.rpcss-tmgyw8 a{color:#000;-webkit-transition:200ms ease-in-out color;transition:200ms ease-in-out color;}@media (hover: hover){.rpcss-tmgyw8 a:hover{color:#13C35A;}}.rpcss-tmgyw8 img{max-width:100%;height:auto;opacity:0;-webkit-transition:300ms ease-out opacity;transition:300ms ease-out opacity;}.rpcss-tmgyw8 pre{padding:10px 20px;overflow-x:auto;-webkit-overflow-scrolling:touch;font-size:16px;border-radius:8px;}.rpcss-tmgyw8 code{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:0.85em;line-height:1;}.rpcss-tmgyw8 table{width:100%;text-align:center;}.rpcss-tmgyw8 table thead th{background-color:#000;color:#FFF;padding:10px 0;}.rpcss-tmgyw8 blockquote{opacity:0.6;border-left:4px solid;margin:0;padding:0 20px;}.rpcss-tmgyw8 hr{border-color:rgba(0, 0, 0, 0.1);}</style><div class="rpcss-tmgyw8" role="article"><blockquote>
<p>This is how I choose to represent requests in my ReasonReact apps, there might be different ways that work well for you, but if this is something that you struggle with, that could be a good introduction to see how sum types can help you.</p>
</blockquote>
<p>Given there's no union type in JavaScript, we tend to use the following representation to store a request status in a component state</p>
<pre><code class="hljs language-javascript"><span class="hljs-comment">/* pseudo code */</span>
type state(data, error) = {
  <span class="hljs-attr">isLoading</span>: bool,
  <span class="hljs-attr">error</span>: nullable(error),
  <span class="hljs-attr">data</span>: nullable(data)
};
</code></pre>
<p>and do something like this:</p>
<pre><code class="hljs language-javascript">User.get(<span class="hljs-function">(<span class="hljs-params">error, data</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (error) {
    setState({ <span class="hljs-attr">isLoading</span>: <span class="hljs-literal">false</span>, error });
  } <span class="hljs-keyword">else</span> {
    setState({ <span class="hljs-attr">isLoading</span>: <span class="hljs-literal">false</span>, data });
  }
});
<span class="hljs-comment">/* or */</span>
User.get().then(
  <span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> setState({ <span class="hljs-attr">isLoading</span>: <span class="hljs-literal">false</span>, data }),
  <span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> setState({ <span class="hljs-attr">isLoading</span>: <span class="hljs-literal">false</span>, error })
);
</code></pre>
<p>This pattern has two unfortunate consequences. The first one is that <strong>you can represent impossible states</strong> with it:</p>
<table>
<thead>
<tr><th>isLoading</th><th>error</th><th>data</th><th>Is possible?</th></tr>
</thead>
<tbody>
<tr><td><code>FALSE</code></td><td><code>NULL</code></td><td><code>NULL</code></td><td>✅</td></tr>
<tr><td><code>TRUE</code></td><td><code>NULL</code></td><td><code>NULL</code></td><td>✅</td></tr>
<tr><td><code>FALSE</code></td><td><code>ERROR</code></td><td><code>NULL</code></td><td>✅</td></tr>
<tr><td><code>TRUE</code></td><td><code>ERROR</code></td><td><code>NULL</code></td><td>❌</td></tr>
<tr><td><code>FALSE</code></td><td><code>NULL</code></td><td><code>DATA</code></td><td>✅</td></tr>
<tr><td><code>TRUE</code></td><td><code>NULL</code></td><td><code>DATA</code></td><td>❌</td></tr>
<tr><td><code>FALSE</code></td><td><code>ERROR</code></td><td><code>DATA</code></td><td>❌</td></tr>
<tr><td><code>TRUE</code></td><td><code>ERROR</code></td><td><code>DATA</code></td><td>❌</td></tr>
</tbody>
</table>
<p>The other one is that it makes you mix two different things:</p>
<ul>
<li>the request <strong>temporal</strong> status</li>
<li>the request <strong>success</strong> status</li>
</ul>
<h2>Representing the request status</h2>
<p>Typed functional language often have a <code>Result</code> or <code>Either</code> type. A result can be:</p>
<ul>
<li><code>Ok</code>, I have this data</li>
<li><code>Error</code>, here what's faield</li>
</ul>
<pre><code class="hljs language-reason"><span class="hljs-keyword">type</span> result(&#x27;ok, &#x27;error) =
  | <span class="hljs-constructor">Ok</span>(&#x27;ok)
  | <span class="hljs-constructor">Error</span>(&#x27;error);
</code></pre>
<h2>Representing the request temporal status</h2>
<p>A request can be <strong>inactive</strong> (or &quot;not asked&quot;), <strong>loading</strong> or <strong>done</strong>. Let's create a type that fits that definition:</p>
<pre><code class="hljs language-reason"><span class="hljs-keyword">module</span> <span class="hljs-module-identifier">RequestStatus</span> = {
  <span class="hljs-keyword">type</span> t(&#x27;a) =
    | <span class="hljs-constructor">NotAsked</span>
    | <span class="hljs-constructor">Loading</span>
    | <span class="hljs-constructor">Done</span>(&#x27;a);
};
</code></pre>
<h2>Combining the two</h2>
<pre><code class="hljs language-reason"><span class="hljs-keyword">type</span> state = {
  user: <span class="hljs-module-identifier">RequestStatus</span>.t(<span class="hljs-module-identifier">Result</span>.t(<span class="hljs-module-identifier">User</span>.t, <span class="hljs-module-identifier">UserError</span>.t)),
};

<span class="hljs-keyword">type</span> action =
  | <span class="hljs-constructor">LoadUser</span>
  | <span class="hljs-constructor">ReceiveUser</span>(<span class="hljs-module-identifier">Result</span>.t(<span class="hljs-module-identifier">User</span>.t, <span class="hljs-module-identifier">UserError</span>.t));
</code></pre>
<p>In <strong>state</strong>, we need to have a representation at any point in time, so we need to wrap the <code>Result</code> in a <code>RequestStatus</code> type.</p>
<p>In <strong>action</strong>, <code>Load</code> and <code>Receive</code> already express temporality, <code>Receive</code> will only need to contain the <strong>request success status</strong>.</p>
<p>One big advantage of this approach is that we don't need to transform the success status in order to store it in the state, we only need to wrap it in a <code>RequestStatus</code>, meaning we only need one codepath in trivial situations.</p>
<p>In my component's reducer, I'll have something like the following:</p>
<pre><code class="hljs language-reason"><span class="hljs-keyword">switch</span> (action) {
| <span class="hljs-constructor">LoadUser</span> =&gt;
  <span class="hljs-constructor">UpdateWithSideEffects</span>(
    {user: <span class="hljs-constructor">Loading</span>},
    (
      ({send}) =&gt;
        <span class="hljs-module-identifier">User</span>.query(payload =&gt; send(<span class="hljs-constructor">ReceiveUser</span>(payload)))
    ),
  )
| <span class="hljs-constructor">ReceiveUser</span>(payload) =&gt; <span class="hljs-constructor">Update</span>({user: <span class="hljs-constructor">Done</span>(payload)})
};
</code></pre>
<p>In my render function, I can then simply pattern match and have exhaustivity checks for free:</p>
<pre><code class="hljs language-reason"><span class="hljs-keyword">switch</span> (state.user) {
| <span class="hljs-constructor">NotAsked</span> =&gt; &lt;<span class="hljs-module-identifier">Button</span> onPress=(() =&gt; send(<span class="hljs-constructor">LoadUser</span>)) title=<span class="hljs-string">&quot;Load&quot;</span> /&gt;
| <span class="hljs-constructor">Loading</span> =&gt; &lt;<span class="hljs-module-identifier">ActivityIndicator</span> /&gt;
| <span class="hljs-constructor">Done</span>(<span class="hljs-constructor">Error</span>(error)) =&gt; &lt;<span class="hljs-module-identifier">ErrorIndicator</span> error /&gt;
| <span class="hljs-constructor">Done</span>(<span class="hljs-constructor">Ok</span>(user)) =&gt; &lt;<span class="hljs-module-identifier">UserCard</span> user /&gt;
};
</code></pre>
</div><style data-emotion="rpcss 1wrrirm">.rpcss-1wrrirm{max-width:640px;width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:spaceBetween;-ms-flex-pack:spaceBetween;-webkit-justify-content:spaceBetween;justify-content:spaceBetween;margin:20px 0;padding:20px;border:0.5px dashed;border-radius:10px;}@media (max-width: 540px){.rpcss-1wrrirm{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}}</style><div class="rpcss-1wrrirm"><style data-emotion="rpcss 1p761yt">.rpcss-1p761yt{font-weight:900;font-size:18px;}</style><div class="rpcss-1p761yt">Liked this article?</div><div class="rpcss-klacsp"></div><style data-emotion="rpcss mumwm1">.rpcss-mumwm1{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;}@media (max-width: 540px){.rpcss-mumwm1{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}}</style><div class="rpcss-mumwm1"><style data-emotion="rpcss 14isay4">.rpcss-14isay4{background-color:#00aced;color:#fff;padding:10px 20px;-webkit-text-decoration:none;text-decoration:none;border-radius:5px;font-weight:900;}.rpcss-14isay4:active{opacity:0.5;}</style><a class="rpcss-14isay4" href="https://www.twitter.com/intent/tweet?text=Requests%20with%20ReasonML%20from%20%40bloodyowl%20https%3A%2F%2Fbloodyowl.io%2Fblog%2F2019-01-20-requests-with-reasonml" target="_blank">→ Share it on Twitter</a><style data-emotion="rpcss 4cf197">.rpcss-4cf197{width:10px;height:10px;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;}</style><div class="rpcss-4cf197"></div><style data-emotion="rpcss v8vdfl">.rpcss-v8vdfl{background-color:#ea4aaa;color:#fff;padding:10px 20px;-webkit-text-decoration:none;text-decoration:none;border-radius:5px;font-weight:900;}.rpcss-v8vdfl:active{opacity:0.5;}</style><a class="rpcss-v8vdfl" href="https://github.com/sponsors/bloodyowl" rel="noopener" target="_blank">→ Sponsor me on GitHub</a></div></div></div></div></div><div class="rpcss-16zgwmd"><style data-emotion="rpcss 12g76gf">.rpcss-12g76gf{text-align:center;padding:10vh 0;opacity:0.7;}</style><footer class="rpcss-12g76gf">© Matthias Le Brun</footer></div></div></div><script id="initialData" type="text/data">{"lists":{"RE_PRIVATE_NONE":true},"items":{"k":"blog","v":{"k":"2019-01-20-requests-with-reasonml","v":{"_0":{"TAG":0,"_0":{"slug":"2019-01-20-requests-with-reasonml","filename":"2019-01-20-requests-with-reasonml","title":"Requests with ReasonML","date":"Sun, 20 Jan 2019 00:00:00 GMT","draft":false,"meta":{"date":"2019-01-20T00:00:00.000Z","title":"Requests with ReasonML"},"body":"\u003cblockquote>\n\u003cp>This is how I choose to represent requests in my ReasonReact apps, there might be different ways that work well for you, but if this is something that you struggle with, that could be a good introduction to see how sum types can help you.\u003c/p>\n\u003c/blockquote>\n\u003cp>Given there's no union type in JavaScript, we tend to use the following representation to store a request status in a component state\u003c/p>\n\u003cpre>\u003ccode class=\"hljs language-javascript\">\u003cspan class=\"hljs-comment\">/* pseudo code */\u003c/span>\ntype state(data, error) = {\n  \u003cspan class=\"hljs-attr\">isLoading\u003c/span>: bool,\n  \u003cspan class=\"hljs-attr\">error\u003c/span>: nullable(error),\n  \u003cspan class=\"hljs-attr\">data\u003c/span>: nullable(data)\n};\n\u003c/code>\u003c/pre>\n\u003cp>and do something like this:\u003c/p>\n\u003cpre>\u003ccode class=\"hljs language-javascript\">User.get(\u003cspan class=\"hljs-function\">(\u003cspan class=\"hljs-params\">error, data\u003c/span>) =&gt;\u003c/span> {\n  \u003cspan class=\"hljs-keyword\">if\u003c/span> (error) {\n    setState({ \u003cspan class=\"hljs-attr\">isLoading\u003c/span>: \u003cspan class=\"hljs-literal\">false\u003c/span>, error });\n  } \u003cspan class=\"hljs-keyword\">else\u003c/span> {\n    setState({ \u003cspan class=\"hljs-attr\">isLoading\u003c/span>: \u003cspan class=\"hljs-literal\">false\u003c/span>, data });\n  }\n});\n\u003cspan class=\"hljs-comment\">/* or */\u003c/span>\nUser.get().then(\n  \u003cspan class=\"hljs-function\">\u003cspan class=\"hljs-params\">data\u003c/span> =&gt;\u003c/span> setState({ \u003cspan class=\"hljs-attr\">isLoading\u003c/span>: \u003cspan class=\"hljs-literal\">false\u003c/span>, data }),\n  \u003cspan class=\"hljs-function\">\u003cspan class=\"hljs-params\">error\u003c/span> =&gt;\u003c/span> setState({ \u003cspan class=\"hljs-attr\">isLoading\u003c/span>: \u003cspan class=\"hljs-literal\">false\u003c/span>, error })\n);\n\u003c/code>\u003c/pre>\n\u003cp>This pattern has two unfortunate consequences. The first one is that \u003cstrong>you can represent impossible states\u003c/strong> with it:\u003c/p>\n\u003ctable>\n\u003cthead>\n\u003ctr>\u003cth>isLoading\u003c/th>\u003cth>error\u003c/th>\u003cth>data\u003c/th>\u003cth>Is possible?\u003c/th>\u003c/tr>\n\u003c/thead>\n\u003ctbody>\n\u003ctr>\u003ctd>\u003ccode>FALSE\u003c/code>\u003c/td>\u003ctd>\u003ccode>NULL\u003c/code>\u003c/td>\u003ctd>\u003ccode>NULL\u003c/code>\u003c/td>\u003ctd>✅\u003c/td>\u003c/tr>\n\u003ctr>\u003ctd>\u003ccode>TRUE\u003c/code>\u003c/td>\u003ctd>\u003ccode>NULL\u003c/code>\u003c/td>\u003ctd>\u003ccode>NULL\u003c/code>\u003c/td>\u003ctd>✅\u003c/td>\u003c/tr>\n\u003ctr>\u003ctd>\u003ccode>FALSE\u003c/code>\u003c/td>\u003ctd>\u003ccode>ERROR\u003c/code>\u003c/td>\u003ctd>\u003ccode>NULL\u003c/code>\u003c/td>\u003ctd>✅\u003c/td>\u003c/tr>\n\u003ctr>\u003ctd>\u003ccode>TRUE\u003c/code>\u003c/td>\u003ctd>\u003ccode>ERROR\u003c/code>\u003c/td>\u003ctd>\u003ccode>NULL\u003c/code>\u003c/td>\u003ctd>❌\u003c/td>\u003c/tr>\n\u003ctr>\u003ctd>\u003ccode>FALSE\u003c/code>\u003c/td>\u003ctd>\u003ccode>NULL\u003c/code>\u003c/td>\u003ctd>\u003ccode>DATA\u003c/code>\u003c/td>\u003ctd>✅\u003c/td>\u003c/tr>\n\u003ctr>\u003ctd>\u003ccode>TRUE\u003c/code>\u003c/td>\u003ctd>\u003ccode>NULL\u003c/code>\u003c/td>\u003ctd>\u003ccode>DATA\u003c/code>\u003c/td>\u003ctd>❌\u003c/td>\u003c/tr>\n\u003ctr>\u003ctd>\u003ccode>FALSE\u003c/code>\u003c/td>\u003ctd>\u003ccode>ERROR\u003c/code>\u003c/td>\u003ctd>\u003ccode>DATA\u003c/code>\u003c/td>\u003ctd>❌\u003c/td>\u003c/tr>\n\u003ctr>\u003ctd>\u003ccode>TRUE\u003c/code>\u003c/td>\u003ctd>\u003ccode>ERROR\u003c/code>\u003c/td>\u003ctd>\u003ccode>DATA\u003c/code>\u003c/td>\u003ctd>❌\u003c/td>\u003c/tr>\n\u003c/tbody>\n\u003c/table>\n\u003cp>The other one is that it makes you mix two different things:\u003c/p>\n\u003cul>\n\u003cli>the request \u003cstrong>temporal\u003c/strong> status\u003c/li>\n\u003cli>the request \u003cstrong>success\u003c/strong> status\u003c/li>\n\u003c/ul>\n\u003ch2>Representing the request status\u003c/h2>\n\u003cp>Typed functional language often have a \u003ccode>Result\u003c/code> or \u003ccode>Either\u003c/code> type. A result can be:\u003c/p>\n\u003cul>\n\u003cli>\u003ccode>Ok\u003c/code>, I have this data\u003c/li>\n\u003cli>\u003ccode>Error\u003c/code>, here what's faield\u003c/li>\n\u003c/ul>\n\u003cpre>\u003ccode class=\"hljs language-reason\">\u003cspan class=\"hljs-keyword\">type\u003c/span> result(&#x27;ok, &#x27;error) =\n  | \u003cspan class=\"hljs-constructor\">Ok\u003c/span>(&#x27;ok)\n  | \u003cspan class=\"hljs-constructor\">Error\u003c/span>(&#x27;error);\n\u003c/code>\u003c/pre>\n\u003ch2>Representing the request temporal status\u003c/h2>\n\u003cp>A request can be \u003cstrong>inactive\u003c/strong> (or &quot;not asked&quot;), \u003cstrong>loading\u003c/strong> or \u003cstrong>done\u003c/strong>. Let's create a type that fits that definition:\u003c/p>\n\u003cpre>\u003ccode class=\"hljs language-reason\">\u003cspan class=\"hljs-keyword\">module\u003c/span> \u003cspan class=\"hljs-module-identifier\">RequestStatus\u003c/span> = {\n  \u003cspan class=\"hljs-keyword\">type\u003c/span> t(&#x27;a) =\n    | \u003cspan class=\"hljs-constructor\">NotAsked\u003c/span>\n    | \u003cspan class=\"hljs-constructor\">Loading\u003c/span>\n    | \u003cspan class=\"hljs-constructor\">Done\u003c/span>(&#x27;a);\n};\n\u003c/code>\u003c/pre>\n\u003ch2>Combining the two\u003c/h2>\n\u003cpre>\u003ccode class=\"hljs language-reason\">\u003cspan class=\"hljs-keyword\">type\u003c/span> state = {\n  user: \u003cspan class=\"hljs-module-identifier\">RequestStatus\u003c/span>.t(\u003cspan class=\"hljs-module-identifier\">Result\u003c/span>.t(\u003cspan class=\"hljs-module-identifier\">User\u003c/span>.t, \u003cspan class=\"hljs-module-identifier\">UserError\u003c/span>.t)),\n};\n\n\u003cspan class=\"hljs-keyword\">type\u003c/span> action =\n  | \u003cspan class=\"hljs-constructor\">LoadUser\u003c/span>\n  | \u003cspan class=\"hljs-constructor\">ReceiveUser\u003c/span>(\u003cspan class=\"hljs-module-identifier\">Result\u003c/span>.t(\u003cspan class=\"hljs-module-identifier\">User\u003c/span>.t, \u003cspan class=\"hljs-module-identifier\">UserError\u003c/span>.t));\n\u003c/code>\u003c/pre>\n\u003cp>In \u003cstrong>state\u003c/strong>, we need to have a representation at any point in time, so we need to wrap the \u003ccode>Result\u003c/code> in a \u003ccode>RequestStatus\u003c/code> type.\u003c/p>\n\u003cp>In \u003cstrong>action\u003c/strong>, \u003ccode>Load\u003c/code> and \u003ccode>Receive\u003c/code> already express temporality, \u003ccode>Receive\u003c/code> will only need to contain the \u003cstrong>request success status\u003c/strong>.\u003c/p>\n\u003cp>One big advantage of this approach is that we don't need to transform the success status in order to store it in the state, we only need to wrap it in a \u003ccode>RequestStatus\u003c/code>, meaning we only need one codepath in trivial situations.\u003c/p>\n\u003cp>In my component's reducer, I'll have something like the following:\u003c/p>\n\u003cpre>\u003ccode class=\"hljs language-reason\">\u003cspan class=\"hljs-keyword\">switch\u003c/span> (action) {\n| \u003cspan class=\"hljs-constructor\">LoadUser\u003c/span> =&gt;\n  \u003cspan class=\"hljs-constructor\">UpdateWithSideEffects\u003c/span>(\n    {user: \u003cspan class=\"hljs-constructor\">Loading\u003c/span>},\n    (\n      ({send}) =&gt;\n        \u003cspan class=\"hljs-module-identifier\">User\u003c/span>.query(payload =&gt; send(\u003cspan class=\"hljs-constructor\">ReceiveUser\u003c/span>(payload)))\n    ),\n  )\n| \u003cspan class=\"hljs-constructor\">ReceiveUser\u003c/span>(payload) =&gt; \u003cspan class=\"hljs-constructor\">Update\u003c/span>({user: \u003cspan class=\"hljs-constructor\">Done\u003c/span>(payload)})\n};\n\u003c/code>\u003c/pre>\n\u003cp>In my render function, I can then simply pattern match and have exhaustivity checks for free:\u003c/p>\n\u003cpre>\u003ccode class=\"hljs language-reason\">\u003cspan class=\"hljs-keyword\">switch\u003c/span> (state.user) {\n| \u003cspan class=\"hljs-constructor\">NotAsked\u003c/span> =&gt; &lt;\u003cspan class=\"hljs-module-identifier\">Button\u003c/span> onPress=(() =&gt; send(\u003cspan class=\"hljs-constructor\">LoadUser\u003c/span>)) title=\u003cspan class=\"hljs-string\">&quot;Load&quot;\u003c/span> /&gt;\n| \u003cspan class=\"hljs-constructor\">Loading\u003c/span> =&gt; &lt;\u003cspan class=\"hljs-module-identifier\">ActivityIndicator\u003c/span> /&gt;\n| \u003cspan class=\"hljs-constructor\">Done\u003c/span>(\u003cspan class=\"hljs-constructor\">Error\u003c/span>(error)) =&gt; &lt;\u003cspan class=\"hljs-module-identifier\">ErrorIndicator\u003c/span> error /&gt;\n| \u003cspan class=\"hljs-constructor\">Done\u003c/span>(\u003cspan class=\"hljs-constructor\">Ok\u003c/span>(user)) =&gt; &lt;\u003cspan class=\"hljs-module-identifier\">UserCard\u003c/span> user /&gt;\n};\n\u003c/code>\u003c/pre>\n"}}},"h":1,"l":{"RE_PRIVATE_NONE":true},"r":{"RE_PRIVATE_NONE":true}},"h":1,"l":{"RE_PRIVATE_NONE":true},"r":{"RE_PRIVATE_NONE":true}},"listsRequests":{"data":{"RE_PRIVATE_NONE":true}},"itemsRequests":{"data":{"RE_PRIVATE_NONE":true}}}</script><head><script defer="defer" src="/public/main.32bd49101561636cf4ce.js"></script></head></html>