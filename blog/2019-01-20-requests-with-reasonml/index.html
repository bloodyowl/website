<!DOCTYPE html><html lang="en"><head><title data-react-helmet="true">Requests with ReasonML</title><meta data-react-helmet="true" name="description" value="Front-end developer and designer. ReasonML, ReasonReact, ReactJS."/><meta data-react-helmet="true" charset="UTF-8"/><meta data-react-helmet="true" content="w75-P-0ywXWkyZvYPbkSM3VSM2hny25UrfeiWJt3B1k" name="google-site-verification"/><meta data-react-helmet="true" content="width=device-width, initial-scale=1, shrink-to-fit=no, viewport-fit=cover" name="viewport"/><meta data-react-helmet="true" content="summary_large_image" name="twitter:card"/><meta data-react-helmet="true" content="website" property="og:type"/><meta data-react-helmet="true" content="https://bloodyowl.io/public/assets/images/share.jpg" property="og:image"/><meta data-react-helmet="true" content="https://bloodyowl.io/public/assets/images/share.jpg" name="twitter:image"/><meta data-react-helmet="true" content="@bloodyowl" name="twitter:site"/><meta data-react-helmet="true" content="1500" property="og:image:width"/><meta data-react-helmet="true" content="777" property="og:image:height"/><link data-react-helmet="true" href="/public/assets/images/favicon.png" rel="shortcut icon"/><link data-react-helmet="true" href="https://bloodyowl.io/blog/2019-01-20-requests-with-reasonml/" rel="canonical"/><style data-react-helmet="true" >@import url("//hello.myfonts.net/count/3cae5f")</style><script data-react-helmet="true" >window.beOpAsyncInit = function() {
        BeOpSDK.init({
          account: "556e1d2772a6b60100844051"
        });
        BeOpSDK.watch();
      };</script><script data-react-helmet="true" async="true" src="https://widget.beop.io/sdk.js"></script><script>window.PAGES_BOOT_MODE="hydrate";</script></head><div id="root"><style data-emotion="css u2ep3e">@font-face{font-family:HelveticaNowDisplay;src:url("/public/assets/webfonts/regular.woff2"),url("/public/assets/webfonts/regular.woff");font-style:normal;font-weight:400;font-display:swap;}@font-face{font-family:HelveticaNowDisplay;src:url("/public/assets/webfonts/bold.woff2"),url("/public/assets/webfonts/bold.woff");font-style:normal;font-weight:700;font-display:swap;}body{padding:0;margin:0;background-color:#fff;font-family:HelveticaNowDisplay,"Helvetica Neue",Helvetica,Arial,sans-serif;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;min-height:100vh;overflow-x:hidden;}@media (prefers-color-scheme: dark){body{background-color:#222;}}#root{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}html{color:#46515b;font-size:1em;line-height:1.4;-webkit-font-smoothing:antialiased;-webkit-text-size-adjust:100%;}@media (prefers-color-scheme: dark){html{color:#e4ebee;}}*,*:before,*:after{box-sizing:border-box;}</style><style data-emotion="css 1lm8k0f">.css-1lm8k0f{min-height:100vh;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;}</style><div class="css-1lm8k0f"><style data-emotion="css 1kq07em">.css-1kq07em{background-color:#E4EBEE;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;padding:0 env(safe-area-inset-right) 0 env(safe-area-inset-left);}@media (prefers-color-scheme: dark){.css-1kq07em{background-color:#111;}}@media (max-width: 620px){.css-1kq07em{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}}</style><div class="css-1kq07em"><style data-emotion="css 1ku00uy">.css-1ku00uy{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;color:#46515B;-webkit-text-decoration:none;text-decoration:none;}@media (prefers-color-scheme: dark){.css-1ku00uy{color:#E4EBEE;}}</style><a class="css-1ku00uy" href="/"><style data-emotion="css 19jaiin">.css-19jaiin{margin-right:10px;margin-left:20px;-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;}</style><img class="css-19jaiin" alt="" height="32" src="/public/assets/images/owl.svg" width="32"/><style data-emotion="css 16ucz1n">.css-16ucz1n{padding:20px 20px 23px 0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}</style><div aria-level="1" class="css-16ucz1n" role="heading"><style data-emotion="css a6owh4">.css-a6owh4{font-weight:bold;margin-right:10px;white-space:nowrap;}</style><div class="css-a6owh4">Matthias Le Brun</div><div>@bloodyowl</div></div></a><style data-emotion="css 1qpr5ai">.css-1qpr5ai{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}@media (max-width: 620px){.css-1qpr5ai{-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;background-color:#D4E1E6;}}@media (max-width: 620px) and (prefers-color-scheme: dark){.css-1qpr5ai{background-color:#111;}}</style><div class="css-1qpr5ai"><style data-emotion="css 5uxyjd">.css-5uxyjd{padding:20px 20px 23px;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-text-decoration:none;text-decoration:none;color:#46515B;text-align:center;font-weight:bold;}@media (prefers-color-scheme: dark){.css-5uxyjd{color:#E4EBEE;}}@media (max-width: 620px){.css-5uxyjd{-webkit-flex-basis:25%;-ms-flex-preferred-size:25%;flex-basis:25%;padding:10px 10px 13px;}}</style><a class="css-5uxyjd" href="/blog/">Blog</a><style data-emotion="css yvhxql">.css-yvhxql{padding:20px 20px 23px;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-text-decoration:none;text-decoration:none;color:#46515B;text-align:center;}@media (prefers-color-scheme: dark){.css-yvhxql{color:#E4EBEE;}}@media (max-width: 620px){.css-yvhxql{-webkit-flex-basis:25%;-ms-flex-preferred-size:25%;flex-basis:25%;padding:10px 10px 13px;}}</style><a class="css-yvhxql" href="https://twitter.com/bloodyowl">Twitter</a><a class="css-yvhxql" href="https://github.com/bloodyowl">GitHub</a><a class="css-yvhxql" href="https://www.linkedin.com/in/bloodyowl">LinkedIn</a></div></div><style data-emotion="css n63pef">.css-n63pef{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;padding-left:env(safe-area-inset-left);padding-right:env(safe-area-inset-right);}</style><div class="css-n63pef"><style data-emotion="css n0fndg">.css-n0fndg{max-width:640px;margin:20px auto;padding:0 10px;width:100%;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}</style><div class="css-n0fndg"><style data-emotion="css apovzu">.css-apovzu{margin:0;font-size:48px;margin-top:50px;margin-bottom:10px;line-height:1.15;}</style><h1 class="css-apovzu">Requests with ReasonML</h1><style data-emotion="css 12xm3b2">.css-12xm3b2{font-size:14px;opacity:0.5;margin-bottom:50px;}</style><div class="css-12xm3b2">2019/01/20</div><style data-emotion="css 1e5av0n">.css-1e5av0n{margin-top:40px;font-size:20px;line-height:1.5;}.css-1e5av0n a{color:#135EFF;}.css-1e5av0n a:hover{color:#13A3FF;}@media (prefers-color-scheme: dark){.css-1e5av0n a{color:#13A3FF;}}.css-1e5av0n img{max-width:100%;height:auto;opacity:0;-webkit-transition:300ms ease-out opacity;transition:300ms ease-out opacity;}.css-1e5av0n pre{padding:10px 20px;background-color:#F4F7F8;overflow-x:auto;-webkit-overflow-scrolling:touch;font-size:16px;border-left:2px solid #46515B;border-left-width:2px;}@media (prefers-color-scheme: dark){.css-1e5av0n pre{background-color:rgba(0, 0, 0, 0.9);}}.css-1e5av0n code{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:0.85em;line-height:1;}.css-1e5av0n .hljs-keyword{color:#DA6BB5;}.css-1e5av0n .hljs-constructor{color:#DD792B;}.css-1e5av0n .hljs-identifier{color:#1E9EA7;}.css-1e5av0n .hljs-module-identifier{color:#C84682;}.css-1e5av0n .hljs-string{color:#3BA1C8;}.css-1e5av0n .hljs-comment{color:#aaa;}.css-1e5av0n .hljs-operator{color:#DA6BB5;}.css-1e5av0n .hljs-attribute{color:#4CB877;}.css-1e5av0n table{width:100%;text-align:center;}.css-1e5av0n table thead th{background-color:#E4EBEE;padding:10px 0;}@media (prefers-color-scheme: dark){.css-1e5av0n table thead th{background-color:#111;}}.css-1e5av0n blockquote{opacity:0.6;border-left:4px solid #46515B;margin:0;padding:0 20px;}.css-1e5av0n hr{border-color:rgba(0, 0, 0, 0.1);}@media (prefers-color-scheme: dark){.css-1e5av0n hr{border-color:rgba(255, 255, 255, 0.1);}}</style><div class="css-1e5av0n" role="article"><blockquote>
<p>This is how I choose to represent requests in my ReasonReact apps, there might be different ways that work well for you, but if this is something that you struggle with, that could be a good introduction to see how sum types can help you.</p>
</blockquote>
<p>Given there's no union type in JavaScript, we tend to use the following representation to store a request status in a component state</p>
<pre><code class="language-javascript"><span class="hljs-comment">/* pseudo code */</span>
type state(data, error) = {
  <span class="hljs-attr">isLoading</span>: bool,
  <span class="hljs-attr">error</span>: nullable(error),
  <span class="hljs-attr">data</span>: nullable(data)
};
</code></pre>
<p>and do something like this:</p>
<pre><code class="language-javascript">User.get(<span class="hljs-function">(<span class="hljs-params">error, data</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (error) {
    setState({ <span class="hljs-attr">isLoading</span>: <span class="hljs-literal">false</span>, error });
  } <span class="hljs-keyword">else</span> {
    setState({ <span class="hljs-attr">isLoading</span>: <span class="hljs-literal">false</span>, data });
  }
});
<span class="hljs-comment">/* or */</span>
User.get().then(
  <span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> setState({ <span class="hljs-attr">isLoading</span>: <span class="hljs-literal">false</span>, data }),
  <span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> setState({ <span class="hljs-attr">isLoading</span>: <span class="hljs-literal">false</span>, error })
);
</code></pre>
<p>This pattern has two unfortunate consequences. The first one is that <strong>you can represent impossible states</strong> with it:</p>
<table>
<thead>
<tr><th>isLoading</th><th>error</th><th>data</th><th>Is possible?</th></tr>
</thead>
<tbody>
<tr><td><code>FALSE</code></td><td><code>NULL</code></td><td><code>NULL</code></td><td>✅</td></tr>
<tr><td><code>TRUE</code></td><td><code>NULL</code></td><td><code>NULL</code></td><td>✅</td></tr>
<tr><td><code>FALSE</code></td><td><code>ERROR</code></td><td><code>NULL</code></td><td>✅</td></tr>
<tr><td><code>TRUE</code></td><td><code>ERROR</code></td><td><code>NULL</code></td><td>❌</td></tr>
<tr><td><code>FALSE</code></td><td><code>NULL</code></td><td><code>DATA</code></td><td>✅</td></tr>
<tr><td><code>TRUE</code></td><td><code>NULL</code></td><td><code>DATA</code></td><td>❌</td></tr>
<tr><td><code>FALSE</code></td><td><code>ERROR</code></td><td><code>DATA</code></td><td>❌</td></tr>
<tr><td><code>TRUE</code></td><td><code>ERROR</code></td><td><code>DATA</code></td><td>❌</td></tr>
</tbody>
</table>
<p>The other one is that it makes you mix two different things:</p>
<ul>
<li>the request <strong>temporal</strong> status</li>
<li>the request <strong>success</strong> status</li>
</ul>
<h2>Representing the request status</h2>
<p>Typed functional language often have a <code>Result</code> or <code>Either</code> type. A result can be:</p>
<ul>
<li><code>Ok</code>, I have this data</li>
<li><code>Error</code>, here what's faield</li>
</ul>
<pre><code class="language-reason"><span class="hljs-keyword">type</span> result(&#x27;ok, &#x27;error) =
  | <span class="hljs-constructor">Ok</span>(&#x27;ok)
  | <span class="hljs-constructor">Error</span>(&#x27;error);
</code></pre>
<h2>Representing the request temporal status</h2>
<p>A request can be <strong>inactive</strong> (or &quot;not asked&quot;), <strong>loading</strong> or <strong>done</strong>. Let's create a type that fits that definition:</p>
<pre><code class="language-reason"><span class="hljs-keyword">module</span> <span class="hljs-module-identifier">RequestStatus</span> = {
  <span class="hljs-keyword">type</span> t(&#x27;a) =
    | <span class="hljs-constructor">NotAsked</span>
    | <span class="hljs-constructor">Loading</span>
    | <span class="hljs-constructor">Done</span>(&#x27;a);
};
</code></pre>
<h2>Combining the two</h2>
<pre><code class="language-reason"><span class="hljs-keyword">type</span> state = {
  user: <span class="hljs-module-identifier">RequestStatus</span>.t(<span class="hljs-module-identifier">Result</span>.t(<span class="hljs-module-identifier">User</span>.t, <span class="hljs-module-identifier">UserError</span>.t)),
};

<span class="hljs-keyword">type</span> action =
  | <span class="hljs-constructor">LoadUser</span>
  | <span class="hljs-constructor">ReceiveUser</span>(<span class="hljs-module-identifier">Result</span>.t(<span class="hljs-module-identifier">User</span>.t, <span class="hljs-module-identifier">UserError</span>.t));
</code></pre>
<p>In <strong>state</strong>, we need to have a representation at any point in time, so we need to wrap the <code>Result</code> in a <code>RequestStatus</code> type.</p>
<p>In <strong>action</strong>, <code>Load</code> and <code>Receive</code> already express temporality, <code>Receive</code> will only need to contain the <strong>request success status</strong>.</p>
<p>One big advantage of this approach is that we don't need to transform the success status in order to store it in the state, we only need to wrap it in a <code>RequestStatus</code>, meaning we only need one codepath in trivial situations.</p>
<p>In my component's reducer, I'll have something like the following:</p>
<pre><code class="language-reason"><span class="hljs-keyword">switch</span> (action) {
| <span class="hljs-constructor">LoadUser</span> =&gt;
  <span class="hljs-constructor">UpdateWithSideEffects</span>(
    {user: <span class="hljs-constructor">Loading</span>},
    (
      ({send}) =&gt;
        <span class="hljs-module-identifier">User</span>.query(payload =&gt; send(<span class="hljs-constructor">ReceiveUser</span>(payload)))
    ),
  )
| <span class="hljs-constructor">ReceiveUser</span>(payload) =&gt; <span class="hljs-constructor">Update</span>({user: <span class="hljs-constructor">Done</span>(payload)})
};
</code></pre>
<p>In my render function, I can then simply pattern match and have exhaustivity checks for free:</p>
<pre><code class="language-reason"><span class="hljs-keyword">switch</span> (state.user) {
| <span class="hljs-constructor">NotAsked</span> =&gt; &lt;<span class="hljs-module-identifier">Button</span> onPress=(() =&gt; send(<span class="hljs-constructor">LoadUser</span>)) title=<span class="hljs-string">&quot;Load&quot;</span> /&gt;
| <span class="hljs-constructor">Loading</span> =&gt; &lt;<span class="hljs-module-identifier">ActivityIndicator</span> /&gt;
| <span class="hljs-constructor">Done</span>(<span class="hljs-constructor">Error</span>(error)) =&gt; &lt;<span class="hljs-module-identifier">ErrorIndicator</span> error /&gt;
| <span class="hljs-constructor">Done</span>(<span class="hljs-constructor">Ok</span>(user)) =&gt; &lt;<span class="hljs-module-identifier">UserCard</span> user /&gt;
};
</code></pre>
</div><style data-emotion="css 1ioslcv">.css-1ioslcv{max-width:640px;width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:spaceBetween;-ms-flex-pack:spaceBetween;-webkit-justify-content:spaceBetween;justify-content:spaceBetween;margin:20px 0;padding:20px;background-color:#FFF;border-radius:10px;box-shadow:0 15px 15px 5px rgba(0, 0, 0, 0.2),0 0 0 1px rgba(0, 0, 0, 0.1);}@media (prefers-color-scheme: dark){.css-1ioslcv{background-color:#111;}}@media (max-width: 540px){.css-1ioslcv{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}}</style><div class="css-1ioslcv"><style data-emotion="css 1p761yt">.css-1p761yt{font-weight:900;font-size:18px;}</style><div class="css-1p761yt">Liked this article?</div><style data-emotion="css klacsp">.css-klacsp{width:0;height:10px;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;}</style><div class="css-klacsp"></div><style data-emotion="css mumwm1">.css-mumwm1{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;}@media (max-width: 540px){.css-mumwm1{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}}</style><div class="css-mumwm1"><style data-emotion="css 14isay4">.css-14isay4{background-color:#00aced;color:#fff;padding:10px 20px;-webkit-text-decoration:none;text-decoration:none;border-radius:5px;font-weight:900;}.css-14isay4:active{opacity:0.5;}</style><a class="css-14isay4" href="https://www.twitter.com/intent/tweet?text=Requests%20with%20ReasonML%20from%20%40bloodyowl%20https%3A%2F%2Fbloodyowl.io%2Fblog%2F2019-01-20-requests-with-reasonml" target="_blank">→ Share it on Twitter</a><style data-emotion="css 4cf197">.css-4cf197{width:10px;height:10px;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;}</style><div class="css-4cf197"></div><style data-emotion="css v8vdfl">.css-v8vdfl{background-color:#ea4aaa;color:#fff;padding:10px 20px;-webkit-text-decoration:none;text-decoration:none;border-radius:5px;font-weight:900;}.css-v8vdfl:active{opacity:0.5;}</style><a class="css-v8vdfl" href="https://github.com/sponsors/bloodyowl" rel="noopener" target="_blank">→ Sponsor me on GitHub</a></div></div><style data-emotion="css sq4ju6">.css-sq4ju6{padding:10px 0;}</style><div class="css-sq4ju6"><div class="BeOpWidget"></div></div></div></div><style data-emotion="css 7az74g">.css-7az74g{background-color:#46515B;color:#fff;text-align:center;padding:20px;font-size:14px;}@media (prefers-color-scheme: dark){.css-7az74g{background-color:#000;}}</style><div class="css-7az74g"><div>Copyright 2021 - Matthias Le Brun</div><div><style data-emotion="css 1tzeee1">.css-1tzeee1{opacity:0.5;}</style><span class="css-1tzeee1">Do you like the content? </span><style data-emotion="css 1d5fxl9">.css-1d5fxl9{color:#EC8AC5;}.css-1d5fxl9:hover{color:#F9BDE1;}</style><a class="css-1d5fxl9" href="https://github.com/sponsors/bloodyowl"> Sponsor me on GitHub</a></div></div></div></div><script id="initialData" type="text/data">{"lists":{"RE_PRIVATE_NONE":true},"items":{"k":"blog","v":{"k":"2019-01-20-requests-with-reasonml","v":{"_0":{"TAG":0,"_0":{"slug":"2019-01-20-requests-with-reasonml","filename":"2019-01-20-requests-with-reasonml","title":"Requests with ReasonML","date":"Sun, 20 Jan 2019 00:00:00 GMT","draft":false,"meta":{"date":"2019-01-20T00:00:00.000Z","title":"Requests with ReasonML"},"body":"<blockquote>\n<p>This is how I choose to represent requests in my ReasonReact apps, there might be different ways that work well for you, but if this is something that you struggle with, that could be a good introduction to see how sum types can help you.</p>\n</blockquote>\n<p>Given there's no union type in JavaScript, we tend to use the following representation to store a request status in a component state</p>\n<pre><code class=\"language-javascript\"><span class=\"hljs-comment\">/* pseudo code */</span>\ntype state(data, error) = {\n  <span class=\"hljs-attr\">isLoading</span>: bool,\n  <span class=\"hljs-attr\">error</span>: nullable(error),\n  <span class=\"hljs-attr\">data</span>: nullable(data)\n};\n</code></pre>\n<p>and do something like this:</p>\n<pre><code class=\"language-javascript\">User.get(<span class=\"hljs-function\">(<span class=\"hljs-params\">error, data</span>) =&gt;</span> {\n  <span class=\"hljs-keyword\">if</span> (error) {\n    setState({ <span class=\"hljs-attr\">isLoading</span>: <span class=\"hljs-literal\">false</span>, error });\n  } <span class=\"hljs-keyword\">else</span> {\n    setState({ <span class=\"hljs-attr\">isLoading</span>: <span class=\"hljs-literal\">false</span>, data });\n  }\n});\n<span class=\"hljs-comment\">/* or */</span>\nUser.get().then(\n  <span class=\"hljs-function\"><span class=\"hljs-params\">data</span> =&gt;</span> setState({ <span class=\"hljs-attr\">isLoading</span>: <span class=\"hljs-literal\">false</span>, data }),\n  <span class=\"hljs-function\"><span class=\"hljs-params\">error</span> =&gt;</span> setState({ <span class=\"hljs-attr\">isLoading</span>: <span class=\"hljs-literal\">false</span>, error })\n);\n</code></pre>\n<p>This pattern has two unfortunate consequences. The first one is that <strong>you can represent impossible states</strong> with it:</p>\n<table>\n<thead>\n<tr><th>isLoading</th><th>error</th><th>data</th><th>Is possible?</th></tr>\n</thead>\n<tbody>\n<tr><td><code>FALSE</code></td><td><code>NULL</code></td><td><code>NULL</code></td><td>✅</td></tr>\n<tr><td><code>TRUE</code></td><td><code>NULL</code></td><td><code>NULL</code></td><td>✅</td></tr>\n<tr><td><code>FALSE</code></td><td><code>ERROR</code></td><td><code>NULL</code></td><td>✅</td></tr>\n<tr><td><code>TRUE</code></td><td><code>ERROR</code></td><td><code>NULL</code></td><td>❌</td></tr>\n<tr><td><code>FALSE</code></td><td><code>NULL</code></td><td><code>DATA</code></td><td>✅</td></tr>\n<tr><td><code>TRUE</code></td><td><code>NULL</code></td><td><code>DATA</code></td><td>❌</td></tr>\n<tr><td><code>FALSE</code></td><td><code>ERROR</code></td><td><code>DATA</code></td><td>❌</td></tr>\n<tr><td><code>TRUE</code></td><td><code>ERROR</code></td><td><code>DATA</code></td><td>❌</td></tr>\n</tbody>\n</table>\n<p>The other one is that it makes you mix two different things:</p>\n<ul>\n<li>the request <strong>temporal</strong> status</li>\n<li>the request <strong>success</strong> status</li>\n</ul>\n<h2>Representing the request status</h2>\n<p>Typed functional language often have a <code>Result</code> or <code>Either</code> type. A result can be:</p>\n<ul>\n<li><code>Ok</code>, I have this data</li>\n<li><code>Error</code>, here what's faield</li>\n</ul>\n<pre><code class=\"language-reason\"><span class=\"hljs-keyword\">type</span> result(&#x27;ok, &#x27;error) =\n  | <span class=\"hljs-constructor\">Ok</span>(&#x27;ok)\n  | <span class=\"hljs-constructor\">Error</span>(&#x27;error);\n</code></pre>\n<h2>Representing the request temporal status</h2>\n<p>A request can be <strong>inactive</strong> (or &quot;not asked&quot;), <strong>loading</strong> or <strong>done</strong>. Let's create a type that fits that definition:</p>\n<pre><code class=\"language-reason\"><span class=\"hljs-keyword\">module</span> <span class=\"hljs-module-identifier\">RequestStatus</span> = {\n  <span class=\"hljs-keyword\">type</span> t(&#x27;a) =\n    | <span class=\"hljs-constructor\">NotAsked</span>\n    | <span class=\"hljs-constructor\">Loading</span>\n    | <span class=\"hljs-constructor\">Done</span>(&#x27;a);\n};\n</code></pre>\n<h2>Combining the two</h2>\n<pre><code class=\"language-reason\"><span class=\"hljs-keyword\">type</span> state = {\n  user: <span class=\"hljs-module-identifier\">RequestStatus</span>.t(<span class=\"hljs-module-identifier\">Result</span>.t(<span class=\"hljs-module-identifier\">User</span>.t, <span class=\"hljs-module-identifier\">UserError</span>.t)),\n};\n\n<span class=\"hljs-keyword\">type</span> action =\n  | <span class=\"hljs-constructor\">LoadUser</span>\n  | <span class=\"hljs-constructor\">ReceiveUser</span>(<span class=\"hljs-module-identifier\">Result</span>.t(<span class=\"hljs-module-identifier\">User</span>.t, <span class=\"hljs-module-identifier\">UserError</span>.t));\n</code></pre>\n<p>In <strong>state</strong>, we need to have a representation at any point in time, so we need to wrap the <code>Result</code> in a <code>RequestStatus</code> type.</p>\n<p>In <strong>action</strong>, <code>Load</code> and <code>Receive</code> already express temporality, <code>Receive</code> will only need to contain the <strong>request success status</strong>.</p>\n<p>One big advantage of this approach is that we don't need to transform the success status in order to store it in the state, we only need to wrap it in a <code>RequestStatus</code>, meaning we only need one codepath in trivial situations.</p>\n<p>In my component's reducer, I'll have something like the following:</p>\n<pre><code class=\"language-reason\"><span class=\"hljs-keyword\">switch</span> (action) {\n| <span class=\"hljs-constructor\">LoadUser</span> =&gt;\n  <span class=\"hljs-constructor\">UpdateWithSideEffects</span>(\n    {user: <span class=\"hljs-constructor\">Loading</span>},\n    (\n      ({send}) =&gt;\n        <span class=\"hljs-module-identifier\">User</span>.query(payload =&gt; send(<span class=\"hljs-constructor\">ReceiveUser</span>(payload)))\n    ),\n  )\n| <span class=\"hljs-constructor\">ReceiveUser</span>(payload) =&gt; <span class=\"hljs-constructor\">Update</span>({user: <span class=\"hljs-constructor\">Done</span>(payload)})\n};\n</code></pre>\n<p>In my render function, I can then simply pattern match and have exhaustivity checks for free:</p>\n<pre><code class=\"language-reason\"><span class=\"hljs-keyword\">switch</span> (state.user) {\n| <span class=\"hljs-constructor\">NotAsked</span> =&gt; &lt;<span class=\"hljs-module-identifier\">Button</span> onPress=(() =&gt; send(<span class=\"hljs-constructor\">LoadUser</span>)) title=<span class=\"hljs-string\">&quot;Load&quot;</span> /&gt;\n| <span class=\"hljs-constructor\">Loading</span> =&gt; &lt;<span class=\"hljs-module-identifier\">ActivityIndicator</span> /&gt;\n| <span class=\"hljs-constructor\">Done</span>(<span class=\"hljs-constructor\">Error</span>(error)) =&gt; &lt;<span class=\"hljs-module-identifier\">ErrorIndicator</span> error /&gt;\n| <span class=\"hljs-constructor\">Done</span>(<span class=\"hljs-constructor\">Ok</span>(user)) =&gt; &lt;<span class=\"hljs-module-identifier\">UserCard</span> user /&gt;\n};\n</code></pre>\n"}}},"h":1,"l":{"RE_PRIVATE_NONE":true},"r":{"RE_PRIVATE_NONE":true}},"h":1,"l":{"RE_PRIVATE_NONE":true},"r":{"RE_PRIVATE_NONE":true}},"listsRequests":{"data":{"RE_PRIVATE_NONE":true}},"itemsRequests":{"data":{"RE_PRIVATE_NONE":true}}}</script><head><script defer="defer" src="/public/main.7b2c01815de9fedd80ff.js"></script></head></html>